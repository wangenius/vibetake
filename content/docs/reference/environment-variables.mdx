---
title: env
---

# ç¯å¢ƒå˜é‡é…ç½®

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜äº† Vibe Template é¡¹ç›®ä¸­ä½¿ç”¨çš„æ‰€æœ‰ç¯å¢ƒå˜é‡ï¼ŒåŒ…æ‹¬å¼€å‘å’Œç”Ÿäº§ç¯å¢ƒçš„é…ç½®æŒ‡å—ï¼Œä»¥åŠå®‰å…¨ç®¡ç†å»ºè®®ã€‚

## æ¦‚è¿°

ç¯å¢ƒå˜é‡ç”¨äºé…ç½®åº”ç”¨ç¨‹åºçš„å„ç§è®¾ç½®ï¼ŒåŒ…æ‹¬æ•°æ®åº“è¿æ¥ã€è®¤è¯é…ç½®ã€ç¬¬ä¸‰æ–¹æœåŠ¡é›†æˆç­‰ã€‚æ­£ç¡®é…ç½®ç¯å¢ƒå˜é‡å¯¹äºåº”ç”¨ç¨‹åºçš„å®‰å…¨æ€§å’ŒåŠŸèƒ½æ€§è‡³å…³é‡è¦ã€‚

## å¿…éœ€çš„ç¯å¢ƒå˜é‡

### æ•°æ®åº“é…ç½®

#### DATABASE_URL
- **ç±»å‹**: `string`
- **å¿…éœ€**: âœ…
- **è¯´æ˜**: æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²
- **æ ¼å¼**: `postgresql://username:password@host:port/database`

**ç¤ºä¾‹**:
```bash
# æœ¬åœ° PostgreSQL
DATABASE_URL=postgresql://postgres:password@localhost:5432/vibe_template

# Supabase
DATABASE_URL=postgresql://postgres:[password]@[host]:5432/postgres

# Railway
DATABASE_URL=postgresql://postgres:[password]@[host]:[port]/railway

# Vercel Postgres
DATABASE_URL=postgresql://[user]:[password]@[host]/[database]?sslmode=require
```

**éªŒè¯**:
```typescript
import { z } from 'zod';

const databaseUrlSchema = z.string().url().refine(
  (url) => url.startsWith('postgresql://'),
  { message: 'DATABASE_URL å¿…é¡»æ˜¯ PostgreSQL è¿æ¥å­—ç¬¦ä¸²' }
);
```

### è®¤è¯é…ç½®

#### BETTER_AUTH_URL
- **ç±»å‹**: `string`
- **å¿…éœ€**: âœ…
- **è¯´æ˜**: è®¤è¯æœåŠ¡çš„åŸºç¡€ URL
- **å¼€å‘ç¯å¢ƒ**: `http://localhost:3000`
- **ç”Ÿäº§ç¯å¢ƒ**: ä½ çš„åŸŸå URL

**ç¤ºä¾‹**:
```bash
# å¼€å‘ç¯å¢ƒ
BETTER_AUTH_URL=http://localhost:3000

# ç”Ÿäº§ç¯å¢ƒ
BETTER_AUTH_URL=https://your-domain.com
```

#### NEXT_PUBLIC_BETTER_AUTH_URL
- **ç±»å‹**: `string`
- **å¿…éœ€**: âœ…
- **è¯´æ˜**: å®¢æˆ·ç«¯å¯è®¿é—®çš„è®¤è¯ URL
- **æ³¨æ„**: ä»¥ `NEXT_PUBLIC_` å¼€å¤´çš„å˜é‡ä¼šæš´éœ²ç»™å®¢æˆ·ç«¯

**ç¤ºä¾‹**:
```bash
# å¼€å‘ç¯å¢ƒ
NEXT_PUBLIC_BETTER_AUTH_URL=http://localhost:3000

# ç”Ÿäº§ç¯å¢ƒ
NEXT_PUBLIC_BETTER_AUTH_URL=https://your-domain.com
```

#### AUTH_SECRET
- **ç±»å‹**: `string`
- **å¿…éœ€**: âœ… (ç”Ÿäº§ç¯å¢ƒ)
- **è¯´æ˜**: ç”¨äºç­¾åå’ŒåŠ å¯†çš„å¯†é’¥
- **ç”Ÿæˆæ–¹å¼**: `openssl rand -base64 32`

**ç¤ºä¾‹**:
```bash
AUTH_SECRET=your-super-secret-key-here
```

**ç”Ÿæˆå¯†é’¥**:
```bash
# ä½¿ç”¨ OpenSSL ç”Ÿæˆ
openssl rand -base64 32

# ä½¿ç”¨ Node.js ç”Ÿæˆ
node -e "console.log(require('crypto').randomBytes(32).toString('base64'))"
```

## å¯é€‰çš„ç¯å¢ƒå˜é‡

### OAuth æä¾›å•†é…ç½®

#### GitHub OAuth
```bash
GITHUB_CLIENT_ID=your-github-client-id
GITHUB_CLIENT_SECRET=your-github-client-secret
```

#### Google OAuth
```bash
GOOGLE_CLIENT_ID=your-google-client-id
GOOGLE_CLIENT_SECRET=your-google-client-secret
```

### ç¬¬ä¸‰æ–¹æœåŠ¡é›†æˆ

#### Stripe æ”¯ä»˜
```bash
STRIPE_PUBLIC_KEY=pk_test_...
STRIPE_SECRET_KEY=sk_test_...
STRIPE_WEBHOOK_SECRET=whsec_...
```

#### Vercel AI SDK
```bash
OPENAI_API_KEY=sk-...
ANTHROPIC_API_KEY=sk-ant-...
```

#### é‚®ä»¶æœåŠ¡
```bash
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=your-email@gmail.com
SMTP_PASSWORD=your-app-password
```

### å¼€å‘å’Œè°ƒè¯•

#### NODE_ENV
- **ç±»å‹**: `string`
- **é»˜è®¤å€¼**: `development`
- **å¯é€‰å€¼**: `development` | `production` | `test`

```bash
NODE_ENV=development
```

#### DEBUG
- **ç±»å‹**: `string`
- **è¯´æ˜**: å¯ç”¨è°ƒè¯•æ—¥å¿—
- **ç¤ºä¾‹**: `DEBUG=app:*` æˆ– `DEBUG=database,auth`

```bash
DEBUG=app:*
```

## ç¯å¢ƒé…ç½®æ–‡ä»¶

### .env.local (æ¨è)
ç”¨äºæœ¬åœ°å¼€å‘çš„ç¯å¢ƒå˜é‡ï¼Œä¸ä¼šè¢«æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶ã€‚

```bash
# .env.local
DATABASE_URL=postgresql://postgres:password@localhost:5432/vibe_template
BETTER_AUTH_URL=http://localhost:3000
NEXT_PUBLIC_BETTER_AUTH_URL=http://localhost:3000
AUTH_SECRET=your-local-secret-key
```

### .env.example
æä¾›ç¯å¢ƒå˜é‡æ¨¡æ¿ï¼Œåº”è¯¥æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶ã€‚

```bash
# .env.example
# Database Configuration
DATABASE_URL=postgresql://username:password@localhost:5432/database_name

# Better Auth Configuration
BETTER_AUTH_URL=http://localhost:3000
NEXT_PUBLIC_BETTER_AUTH_URL=http://localhost:3000
AUTH_SECRET=your-secret-key-here

# Optional: OAuth Providers
GITHUB_CLIENT_ID=
GITHUB_CLIENT_SECRET=

# Optional: Stripe Integration
STRIPE_PUBLIC_KEY=
STRIPE_SECRET_KEY=
```

### .env.production
ç”Ÿäº§ç¯å¢ƒä¸“ç”¨é…ç½®ï¼ˆå¦‚æœéœ€è¦ï¼‰ã€‚

```bash
# .env.production
NODE_ENV=production
DATABASE_URL=postgresql://prod-user:prod-pass@prod-host:5432/prod-db
BETTER_AUTH_URL=https://your-domain.com
NEXT_PUBLIC_BETTER_AUTH_URL=https://your-domain.com
```

## ç¯å¢ƒå˜é‡åŠ è½½é¡ºåº

Next.js æŒ‰ä»¥ä¸‹é¡ºåºåŠ è½½ç¯å¢ƒå˜é‡ï¼š

1. `.env.local` (æ€»æ˜¯è¢«åŠ è½½ï¼Œé™¤äº† test ç¯å¢ƒ)
2. `.env.${NODE_ENV}.local`
3. `.env.${NODE_ENV}`
4. `.env`

**ä¼˜å…ˆçº§**: è¾ƒæ—©åŠ è½½çš„æ–‡ä»¶å…·æœ‰æ›´é«˜çš„ä¼˜å…ˆçº§ã€‚

## ç¯å¢ƒå˜é‡éªŒè¯

### è¿è¡Œæ—¶éªŒè¯

```typescript
// lib/env.ts
import { z } from 'zod';

const envSchema = z.object({
  // æ•°æ®åº“
  DATABASE_URL: z.string().url(),
  
  // è®¤è¯
  BETTER_AUTH_URL: z.string().url(),
  NEXT_PUBLIC_BETTER_AUTH_URL: z.string().url(),
  AUTH_SECRET: z.string().min(32, 'AUTH_SECRET è‡³å°‘éœ€è¦ 32 ä¸ªå­—ç¬¦'),
  
  // å¯é€‰çš„ OAuth
  GITHUB_CLIENT_ID: z.string().optional(),
  GITHUB_CLIENT_SECRET: z.string().optional(),
  
  // ç¯å¢ƒ
  NODE_ENV: z.enum(['development', 'production', 'test']).default('development'),
});

export const env = envSchema.parse(process.env);
```

### æ„å»ºæ—¶éªŒè¯

```typescript
// next.config.ts
const requiredEnvVars = [
  'DATABASE_URL',
  'BETTER_AUTH_URL',
  'NEXT_PUBLIC_BETTER_AUTH_URL',
];

// éªŒè¯å¿…éœ€çš„ç¯å¢ƒå˜é‡
requiredEnvVars.forEach((envVar) => {
  if (!process.env[envVar]) {
    throw new Error(`ç¼ºå°‘å¿…éœ€çš„ç¯å¢ƒå˜é‡: ${envVar}`);
  }
});
```

## ä¸åŒç¯å¢ƒçš„é…ç½®æŒ‡å—

### å¼€å‘ç¯å¢ƒè®¾ç½®

1. **å¤åˆ¶ç¤ºä¾‹æ–‡ä»¶**:
   ```bash
   cp .env.example .env.local
   ```

2. **é…ç½®æœ¬åœ°æ•°æ®åº“**:
   ```bash
   # ä½¿ç”¨ Docker å¯åŠ¨ PostgreSQL
   docker run --name postgres-dev -e POSTGRES_PASSWORD=password -p 5432:5432 -d postgres
   
   # æ›´æ–° .env.local
   DATABASE_URL=postgresql://postgres:password@localhost:5432/vibe_template
   ```

3. **ç”Ÿæˆè®¤è¯å¯†é’¥**:
   ```bash
   # ç”Ÿæˆå¹¶æ·»åŠ åˆ° .env.local
   echo "AUTH_SECRET=$(openssl rand -base64 32)" >> .env.local
   ```

### ç”Ÿäº§ç¯å¢ƒè®¾ç½®

1. **ä½¿ç”¨ç¯å¢ƒå˜é‡ç®¡ç†æœåŠ¡**:
   - Vercel: åœ¨é¡¹ç›®è®¾ç½®ä¸­é…ç½®
   - Railway: ä½¿ç”¨ Railway CLI æˆ– Web ç•Œé¢
   - Docker: ä½¿ç”¨ docker-compose.yml æˆ– Kubernetes secrets

2. **Vercel éƒ¨ç½²é…ç½®**:
   ```bash
   # ä½¿ç”¨ Vercel CLI è®¾ç½®ç¯å¢ƒå˜é‡
   vercel env add DATABASE_URL production
   vercel env add BETTER_AUTH_URL production
   vercel env add AUTH_SECRET production
   ```

3. **Docker éƒ¨ç½²é…ç½®**:
   ```yaml
   # docker-compose.yml
   version: '3.8'
   services:
     app:
       build: .
       environment:
         - DATABASE_URL=${DATABASE_URL}
         - BETTER_AUTH_URL=${BETTER_AUTH_URL}
         - AUTH_SECRET=${AUTH_SECRET}
       env_file:
         - .env.production
   ```

### æµ‹è¯•ç¯å¢ƒè®¾ç½®

```bash
# .env.test
NODE_ENV=test
DATABASE_URL=postgresql://postgres:password@localhost:5432/vibe_template_test
BETTER_AUTH_URL=http://localhost:3000
NEXT_PUBLIC_BETTER_AUTH_URL=http://localhost:3000
AUTH_SECRET=test-secret-key-for-testing-only
```

## å®‰å…¨æœ€ä½³å®è·µ

### 1. æ•æ„Ÿä¿¡æ¯ä¿æŠ¤

**ä¸è¦åš**:
```bash
# âŒ ä¸è¦åœ¨ä»£ç ä¸­ç¡¬ç¼–ç æ•æ„Ÿä¿¡æ¯
const apiKey = 'sk-1234567890abcdef';
```

**åº”è¯¥åš**:
```bash
# âœ… ä½¿ç”¨ç¯å¢ƒå˜é‡
const apiKey = process.env.API_KEY;
```

### 2. ç¯å¢ƒå˜é‡å‘½åè§„èŒƒ

```bash
# âœ… å¥½çš„å‘½å
DATABASE_URL=...
STRIPE_SECRET_KEY=...
NEXT_PUBLIC_API_URL=...

# âŒ é¿å…çš„å‘½å
db=...
key=...
url=...
```

### 3. å®¢æˆ·ç«¯å˜é‡å®‰å…¨

```bash
# âœ… å…¬å¼€çš„é…ç½®ï¼ˆä»¥ NEXT_PUBLIC_ å¼€å¤´ï¼‰
NEXT_PUBLIC_API_URL=https://api.example.com
NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY=pk_...

# âŒ ä¸è¦æš´éœ²æ•æ„Ÿä¿¡æ¯ç»™å®¢æˆ·ç«¯
NEXT_PUBLIC_DATABASE_URL=...  # å±é™©ï¼
NEXT_PUBLIC_SECRET_KEY=...    # å±é™©ï¼
```

### 4. å¯†é’¥è½®æ¢

```typescript
// å®šæœŸè½®æ¢å¯†é’¥çš„å·¥å…·å‡½æ•°
export const rotateSecret = () => {
  const newSecret = crypto.randomBytes(32).toString('base64');
  console.log('æ–°çš„ AUTH_SECRET:', newSecret);
  return newSecret;
};
```

### 5. ç¯å¢ƒéš”ç¦»

```typescript
// ç¡®ä¿ç¯å¢ƒéš”ç¦»
const isDevelopment = process.env.NODE_ENV === 'development';
const isProduction = process.env.NODE_ENV === 'production';

if (isProduction && !process.env.AUTH_SECRET) {
  throw new Error('ç”Ÿäº§ç¯å¢ƒå¿…é¡»è®¾ç½® AUTH_SECRET');
}
```

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **ç¯å¢ƒå˜é‡æœªåŠ è½½**
   ```bash
   Error: Cannot read property 'DATABASE_URL' of undefined
   ```
   
   **è§£å†³æ–¹æ¡ˆ**:
   - æ£€æŸ¥æ–‡ä»¶åæ˜¯å¦æ­£ç¡® (`.env.local`)
   - ç¡®ä¿æ–‡ä»¶åœ¨é¡¹ç›®æ ¹ç›®å½•
   - é‡å¯å¼€å‘æœåŠ¡å™¨

2. **æ•°æ®åº“è¿æ¥å¤±è´¥**
   ```bash
   Error: connect ECONNREFUSED 127.0.0.1:5432
   ```
   
   **è§£å†³æ–¹æ¡ˆ**:
   - æ£€æŸ¥æ•°æ®åº“æ˜¯å¦è¿è¡Œ
   - éªŒè¯ DATABASE_URL æ ¼å¼
   - æ£€æŸ¥ç½‘ç»œè¿æ¥å’Œé˜²ç«å¢™è®¾ç½®

3. **è®¤è¯é…ç½®é”™è¯¯**
   ```bash
   Error: Invalid redirect URI
   ```
   
   **è§£å†³æ–¹æ¡ˆ**:
   - ç¡®ä¿ BETTER_AUTH_URL ä¸å®é™…åŸŸååŒ¹é…
   - æ£€æŸ¥ OAuth åº”ç”¨é…ç½®
   - éªŒè¯ HTTPS è®¾ç½®ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰

### è°ƒè¯•å·¥å…·

```typescript
// ç¯å¢ƒå˜é‡è°ƒè¯•å·¥å…·
export const debugEnv = () => {
  if (process.env.NODE_ENV === 'development') {
    console.log('ç¯å¢ƒå˜é‡çŠ¶æ€:');
    console.log('DATABASE_URL:', process.env.DATABASE_URL ? 'âœ… å·²è®¾ç½®' : 'âŒ æœªè®¾ç½®');
    console.log('BETTER_AUTH_URL:', process.env.BETTER_AUTH_URL ? 'âœ… å·²è®¾ç½®' : 'âŒ æœªè®¾ç½®');
    console.log('AUTH_SECRET:', process.env.AUTH_SECRET ? 'âœ… å·²è®¾ç½®' : 'âŒ æœªè®¾ç½®');
  }
};

// åœ¨åº”ç”¨å¯åŠ¨æ—¶è°ƒç”¨
debugEnv();
```

### ç¯å¢ƒå˜é‡æ£€æŸ¥è„šæœ¬

```javascript
// scripts/check-env.js
const requiredVars = [
  'DATABASE_URL',
  'BETTER_AUTH_URL',
  'NEXT_PUBLIC_BETTER_AUTH_URL',
];

const optionalVars = [
  'AUTH_SECRET',
  'GITHUB_CLIENT_ID',
  'STRIPE_SECRET_KEY',
];

console.log('ğŸ” æ£€æŸ¥ç¯å¢ƒå˜é‡...\n');

// æ£€æŸ¥å¿…éœ€å˜é‡
let hasErrors = false;
requiredVars.forEach(varName => {
  if (process.env[varName]) {
    console.log(`âœ… ${varName}: å·²è®¾ç½®`);
  } else {
    console.log(`âŒ ${varName}: æœªè®¾ç½® (å¿…éœ€)`);
    hasErrors = true;
  }
});

// æ£€æŸ¥å¯é€‰å˜é‡
optionalVars.forEach(varName => {
  if (process.env[varName]) {
    console.log(`âœ… ${varName}: å·²è®¾ç½®`);
  } else {
    console.log(`âš ï¸  ${varName}: æœªè®¾ç½® (å¯é€‰)`);
  }
});

if (hasErrors) {
  console.log('\nâŒ å­˜åœ¨ç¼ºå¤±çš„å¿…éœ€ç¯å¢ƒå˜é‡');
  process.exit(1);
} else {
  console.log('\nâœ… æ‰€æœ‰å¿…éœ€çš„ç¯å¢ƒå˜é‡éƒ½å·²è®¾ç½®');
}
```

**ä½¿ç”¨æ–¹æ³•**:
```bash
node scripts/check-env.js
```

## ç›¸å…³æ–‡æ¡£

- [é…ç½®å‚è€ƒ](./configuration)
- [å®‰è£…æŒ‡å—](../getting-started/installation)
- [éƒ¨ç½²æŒ‡å—](../guides/deployment)
- [å®‰å…¨æœ€ä½³å®è·µ](../guides/security)