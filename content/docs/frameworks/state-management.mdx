---
title: çŠ¶æ€ç®¡ç†
description: ä½¿ç”¨ Zustand è¿›è¡Œåº”ç”¨çŠ¶æ€ç®¡ç†
---

# çŠ¶æ€ç®¡ç†

Vibetake é›†æˆäº† [Zustand](https://zustand-demo.pmnd.rs)ï¼Œæä¾›ç®€å•è€Œå¼ºå¤§çš„çŠ¶æ€ç®¡ç†è§£å†³æ–¹æ¡ˆã€‚

## ç‰¹æ€§

- ğŸ¯ ç®€å•ç›´è§‚çš„ API
- ğŸ“¦ è½»é‡çº§ï¼ˆ2kb gzippedï¼‰
- ğŸ”„ æ”¯æŒå¼‚æ­¥æ“ä½œ
- ğŸ› ï¸ TypeScript å‹å¥½
- ğŸ§ª æ˜“äºæµ‹è¯•

## åŸºæœ¬ä½¿ç”¨

### åˆ›å»º Store

```typescript
// src/stores/user-store.ts
import { create } from 'zustand';
import { persist } from 'zustand/middleware';

interface User {
  id: string;
  name: string;
  email: string;
}

interface UserState {
  user: User | null;
  isLoading: boolean;
  setUser: (user: User) => void;
  clearUser: () => void;
  updateUser: (updates: Partial<User>) => void;
}

export const useUserStore = create<UserState>()(
  persist(
    (set, get) => ({
      user: null,
      isLoading: false,
      
      setUser: (user) => set({ user }),
      
      clearUser: () => set({ user: null }),
      
      updateUser: (updates) => {
        const currentUser = get().user;
        if (currentUser) {
          set({ user: { ...currentUser, ...updates } });
        }
      },
    }),
    {
      name: 'user-storage', // æœ¬åœ°å­˜å‚¨é”®å
      partialize: (state) => ({ user: state.user }), // åªæŒä¹…åŒ– user å­—æ®µ
    }
  )
);
```

### åœ¨ç»„ä»¶ä¸­ä½¿ç”¨

```tsx
'use client';

import { useUserStore } from '@/stores/user-store';

export default function UserProfile() {
  const { user, setUser, clearUser, updateUser } = useUserStore();

  const handleLogin = () => {
    setUser({
      id: '1',
      name: 'å¼ ä¸‰',
      email: 'zhangsan@example.com'
    });
  };

  const handleUpdateName = () => {
    updateUser({ name: 'æå››' });
  };

  if (!user) {
    return (
      <button onClick={handleLogin} className="btn-primary">
        ç™»å½•
      </button>
    );
  }

  return (
    <div className="space-y-4">
      <h2>ç”¨æˆ·ä¿¡æ¯</h2>
      <p>å§“å: {user.name}</p>
      <p>é‚®ç®±: {user.email}</p>
      
      <div className="space-x-2">
        <button onClick={handleUpdateName} className="btn-secondary">
          æ›´æ–°å§“å
        </button>
        <button onClick={clearUser} className="btn-danger">
          ç™»å‡º
        </button>
      </div>
    </div>
  );
}
```

## é«˜çº§ç”¨æ³•

### å¼‚æ­¥æ“ä½œ

```typescript
// src/stores/todo-store.ts
import { create } from 'zustand';

interface Todo {
  id: string;
  title: string;
  completed: boolean;
}

interface TodoState {
  todos: Todo[];
  isLoading: boolean;
  error: string | null;
  
  fetchTodos: () => Promise<void>;
  addTodo: (title: string) => Promise<void>;
  toggleTodo: (id: string) => void;
  deleteTodo: (id: string) => Promise<void>;
}

export const useTodoStore = create<TodoState>((set, get) => ({
  todos: [],
  isLoading: false,
  error: null,

  fetchTodos: async () => {
    set({ isLoading: true, error: null });
    try {
      const response = await fetch('/api/todos');
      const todos = await response.json();
      set({ todos, isLoading: false });
    } catch (error) {
      set({ error: 'è·å–å¾…åŠäº‹é¡¹å¤±è´¥', isLoading: false });
    }
  },

  addTodo: async (title) => {
    set({ isLoading: true });
    try {
      const response = await fetch('/api/todos', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ title }),
      });
      const newTodo = await response.json();
      set(state => ({ 
        todos: [...state.todos, newTodo], 
        isLoading: false 
      }));
    } catch (error) {
      set({ error: 'æ·»åŠ å¾…åŠäº‹é¡¹å¤±è´¥', isLoading: false });
    }
  },

  toggleTodo: (id) => {
    set(state => ({
      todos: state.todos.map(todo =>
        todo.id === id ? { ...todo, completed: !todo.completed } : todo
      )
    }));
  },

  deleteTodo: async (id) => {
    try {
      await fetch(`/api/todos/${id}`, { method: 'DELETE' });
      set(state => ({
        todos: state.todos.filter(todo => todo.id !== id)
      }));
    } catch (error) {
      set({ error: 'åˆ é™¤å¾…åŠäº‹é¡¹å¤±è´¥' });
    }
  },
}));
```

### é€‰æ‹©å™¨ä¼˜åŒ–

```tsx
import { useUserStore } from '@/stores/user-store';
import { shallow } from 'zustand/shallow';

// åªè®¢é˜…ç‰¹å®šå­—æ®µï¼Œé¿å…ä¸å¿…è¦çš„é‡æ¸²æŸ“
export default function UserName() {
  const userName = useUserStore(state => state.user?.name);
  
  return <span>{userName}</span>;
}

// è®¢é˜…å¤šä¸ªå­—æ®µ
export default function UserActions() {
  const { setUser, clearUser } = useUserStore(
    state => ({ setUser: state.setUser, clearUser: state.clearUser }),
    shallow
  );
  
  // ...
}
```

### ä¸­é—´ä»¶ä½¿ç”¨

```typescript
import { create } from 'zustand';
import { devtools, subscribeWithSelector } from 'zustand/middleware';

export const useAppStore = create<AppState>()(
  devtools(
    subscribeWithSelector(
      persist(
        (set, get) => ({
          // store å®ç°
        }),
        { name: 'app-storage' }
      )
    ),
    { name: 'app-store' }
  )
);

// è®¢é˜…çŠ¶æ€å˜åŒ–
useAppStore.subscribe(
  state => state.user,
  (user) => {
    console.log('ç”¨æˆ·çŠ¶æ€å˜åŒ–:', user);
  }
);
```

## æœ€ä½³å®è·µ

1. **æ¨¡å—åŒ–** - å°†ä¸åŒåŠŸèƒ½çš„çŠ¶æ€åˆ†ç¦»åˆ°ä¸åŒçš„ store
2. **é€‰æ‹©å™¨ä¼˜åŒ–** - ä½¿ç”¨é€‰æ‹©å™¨é¿å…ä¸å¿…è¦çš„é‡æ¸²æŸ“
3. **ç±»å‹å®‰å…¨** - å……åˆ†åˆ©ç”¨ TypeScript ç±»å‹æ£€æŸ¥
4. **æŒä¹…åŒ–** - åˆç†ä½¿ç”¨ persist ä¸­é—´ä»¶
5. **æµ‹è¯•** - ä¸º store ç¼–å†™å•å…ƒæµ‹è¯•